<!DOCTYPE html>
<html>
<head>
  <title>Miro Chatbot Architect</title>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/@mirohq/websdk"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, textarea, button { margin-top: 10px; display: block; width: 100%; }
    .section { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
  </style>
</head>
<body>
  <h1>ðŸ¤– Chatbot Architect for Miro</h1>

  <div class="section">
    <h2>1. Project Setup</h2>
    <label>Project Name:</label>
    <input type="text" id="projectName" placeholder="e.g. SuperBot" />
    <label>Website URL:</label>
    <input type="text" id="websiteUrl" placeholder="https://example.com" />
    <label>Upload Context File:</label>
    <input type="file" id="contextFile" />
  </div>

  <div class="section">
    <h2>2. Chat Structure Guide</h2>
    <p>Assign a selected frame to a section:</p>
    <select id="sectionType">
      <option value="welcome">Welcome Message</option>
      <option value="cta">Call to Action</option>
      <option value="faq">FAQ</option>
      <option value="error">Error Handling</option>
      <option value="feedback">Feedback Collection</option>
    </select>
    <button onclick="tagSelection()">Assign Selected Frame</button>
  </div>

  <div class="section">
    <h2>3. Analyze Selected Area</h2>
    <button onclick="analyzeSelection()">Get Context Summary of Selected</button>
    <pre id="output"></pre>
  </div>

  <script>
    async function tagSelection() {
      const selection = await miro.board.getSelection();
      const section = document.getElementById('sectionType').value;

      for (const item of selection) {
        await item.setMetadata('chatbot', { section });
      }
      alert(`Tagged ${selection.length} item(s) as "${section}"`);
    }

    async function analyzeSelection() {
      const selection = await miro.board.getSelection();
      const output = document.getElementById('output');
      output.textContent = '';

      for (const item of selection) {
        const meta = await item.getMetadata('chatbot');
        const text = item.plainText || item.title || '[No text]';
        output.textContent += `ID: ${item.id}\nText: ${text}\nSection: ${meta?.section || 'N/A'}\n---\n`;
      }
    }
  </script>
</body>
</html>
